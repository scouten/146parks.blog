{% extends "base.html" %}

{% block content %}
<div class="park">
  <div class="title-assembly">
    <div class="sequence-assembly">
      <img src="/common/wa-shape.png" alt="" width="99" height="64">
      <div class="sequence">{{ page.extra.seq }}</div>
    </div>
    <div class="title-and-visited">
      <h1 class="title">
        <span class="name">{{ page.title }}</span>
        <span class="designator">{% if page.extra.designator %}{{ page.extra.designator }}{% else %}State Park{% endif %}</span>
      </h1>
      <div class="near">
        <a href="#map">{{ page.extra.near }}, Washington</a>
      </div>
      <div class="visited">
        Visited {% if page.extra.visited %}
          {{ page.extra.visited }}
        {% else %}
          {{ page.date | date(format="%e %B %Y") }}
        {% endif %}
      </div>
    </div>
  </div>
  {{ page.content | safe }}
  <div id="map"></div>
  {% if page.extra.markers %}
  <script src="/common/add-gps-markers.js"></script>
  <script src="https://unpkg.com/@googlemaps/markerclustererplus/dist/index.min.js"></script>
  <script src="{{ page.extra.markers }}"></script>
  {% endif %}
  <script>
    let map;

    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12,
        center: { lat: {{ page.extra.lat }}, lng: {{ page.extra.lon }} },
        mapTypeId: "terrain",
      });

      map.setOptions('TERRAIN');
 
      {% if page.extra.track %}
      var kmlLayer = new google.maps.KmlLayer({
        url: '{{ current_url | safe }}{{ page.extra.track }}',
        preserveViewport: true,
        map: map
      });
      {% endif %}
      {% if page.extra.markers %}
      markers = addGpxMarkers(map);
      const markerCluster = new MarkerClusterer(map, markers,
        {
          imagePath: "{{ config.base_url | safe }}/common/m",
          maxZoom: 20,
        } );
      {% else %}
      const marker = new google.maps.Marker({
        position: { lat: {{ page.extra.lat }}, lng: {{ page.extra.lon }} },
        map: map,
        preserveViewport: false,
      });
      {% endif %}
    }
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdpExDX7tY55VADRaMvxRv7PISFt67sSU&callback=initMap&libraries=&v=weekly"
    async>
  </script>
</div>

<div id="next_prev">
  {% if page.heavier %}
  <div id="next">
    <div class="arrow-l">
      <a href="{{ page.heavier.permalink | safe }}"><img src="/common/arrow-l.png" alt="" width="32" height="32"></a>
    </div>
    <div class="sequence-assembly">
      <a href="{{ page.heavier.permalink | safe }}"><img src="/common/wa-shape.png" alt="" width="49" height="32"></a>
      <div class="sequence"><a href="{{ page.heavier.permalink | safe }}">{% if page.heavier.extra.seq %}{{ page.heavier.extra.seq }}{% endif %}</a></div>
    </div>
    {% if page.heavier.title %}
    <div class="title">
      <a href="{{ page.heavier.permalink | safe }}">
      <span class="name">{{ page.heavier.title }}</span>
      <span class="designator">{% if page.heavier.extra.designator %}{{ page.heavier.extra.designator }}{% else %}State Park{% endif %}</span>
      </a>
    </div>
    {% endif %}
  </div>
  {% endif %}
  {% if page.heavier and page.lighter %}
  <div id="divider"></div>
  {% endif %}
  {% if page.lighter %}
  <div id="prev">
    <div class="sequence-assembly">
      <a href="{{ page.lighter.permalink | safe }}"><img src="/common/wa-shape.png" alt="" width="49" height="32"></a>
      <div class="sequence"><a href="{{ page.lighter.permalink | safe }}">{% if page.lighter.extra.seq %}{{ page.lighter.extra.seq }}{% endif %}</a></div>
    </div>
    {% if page.lighter.title %}
    <div class="title">
      <a href="{{ page.lighter.permalink | safe }}">
      <span class="name">{{ page.lighter.title }}</span>
      <span class="designator">{% if page.lighter.extra.designator %}{{ page.lighter.extra.designator }}{% else %}State Park{% endif %}</span>
      </a>
    </div>
    {% endif %}
    <div class="arrow-r">
      <a href="{{ page.lighter.permalink | safe }}"><img src="/common/arrow-r.png" alt="" width="32" height="32"></a>
    </div>
  </div>
  {% endif %}
</div>

{% endblock content %}
