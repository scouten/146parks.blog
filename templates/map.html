{% extends "base.html" %}

{% block content %}
<div class="map-page">
  {{ page.content | safe }}

  <div id="parks-map"></div>
  <script src="https://unpkg.com/@googlemaps/markerclustererplus/dist/index.min.js"></script>

  <script>
    let map;

    function addParkMarker(map, seq, title, lat, lon, cover, link) {
      const marker = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map,
        title: title,
      });

      const contentString =
        '<div class="park-marker">' +
          '<div class="park-title">' +
          '<a href="' + link + '">' +
          '<span class="seq">' + seq + '</span>. ' +
          '<span class="name">' + title + '</span></a>' +
          '<div class="cover">' +
            '<a href="' + link + '">' +
            '<img src="' + cover + '" width="240" height="135" /></a>' +
          '</div>' +
        '</div>';

      const infoWindow = new google.maps.InfoWindow({
        content: contentString,
        maxWidth: 276,
      });

      marker.addListener("click", () => {
        infoWindow.open(map, marker);
      });
    }

    function initMap() {
      const map = new google.maps.Map(document.getElementById("parks-map"), {
        mapTypeId: "terrain",
      });

      map.setOptions('TERRAIN');

      const bounds = new google.maps.LatLngBounds();
      bounds.extend(new google.maps.LatLng(45.544, -124.673));
      bounds.extend(new google.maps.LatLng(49.003, -116.916));

      map.fitBounds(bounds);

      {% set parks = get_section(path="parks/_index.md") %}
      {% for page in parks.pages %}
      addParkMarker(map,
        {{ page.extra.seq }},
        "{{ page.title }}",
        {{ page.extra.lat }},
        {{ page.extra.lon }},
        "{{ page.permalink | safe }}cover-{{ page.extra.feature | safe }}.jpg",
        "{{ page.permalink | safe }}");
      {% endfor %}

    }
    
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdpExDX7tY55VADRaMvxRv7PISFt67sSU&callback=initMap&libraries=&v=weekly"
    async>
  </script>
</div>

{% endblock content %}
